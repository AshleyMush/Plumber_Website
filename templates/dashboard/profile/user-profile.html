{% extends '/dashboard/base.html' %}

{% block title %}{{ current_user.first_name }}'s Profile{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-2 text-gray-800">{{ current_user.first_name }}'s Profile</h1>

    <!-- Role Card -->
    <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Role</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ current_user.role }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fa-solid fa-ranking-star fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Forms and Information -->
    <div class="row">
        <!-- Left Column -->
        <div class="col-lg-6 mb-4">
            <!-- Web traffic Pie Chart  -->
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Web Traffic Sources <span class="text-muted px-3"><i class="fa-solid fa-code"></i> coming Soon</span></h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                            aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-pie pt-4 pb-2">
                        <canvas id="myPieChart" style="max-width: 100%; height: auto;"></canvas>
                    </div>
                    <div class="mt-4 text-center small">
                        <span class="mr-2">
                            <i class="fas fa-circle text-primary"></i> Direct
                        </span>
                        <span class="mr-2"></span>
                            <i class="fas fa-circle text-success"></i> Social
                        </span>
                        <span class="mr-2">
                            <i class="fas fa-circle text-info"></i> Referral
                        </span>
                    </div>
                </div>
            </div>

            <!-- Social Media Links Form -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Website Set Up Progress  <span class="text-muted px-3"><i class="fa-solid fa-code"></i> coming Soon</span> </h6>
                </div>
                <div class="card-body">
                    <h4 class="small font-weight-bold">Home Page <span class="float-right">20%</span></h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: 20%" aria-valuenow="20"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <h4 class="small font-weight-bold">Services Page <span class="float-right">40%</span></h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 40%" aria-valuenow="40"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <h4 class="small font-weight-bold">About Us Page<span class="float-right">60%</span></h4>
                    <div class="progress mb-4">
                        <div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0"
                            aria-valuemax="100"></div>
                    </div>
                    <h4 class="small font-weight-bold">Contact Us Page<span class="float-right">80%</span></h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-info" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0"
                            aria-valuemax="100"></div>
                    </div>
                    <h4 class="small font-weight-bold">Account Setup <span class="float-right">Complete!</span></h4>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="100"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>

            
        </div>

        <!-- Right Column -->
        <div class="col-lg-6 mb-4">
            <!-- Email Form -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Update Email <span class="text-danger">*</span></h6>
                </div>
                <div class="card-body">
                    <form id="emailForm" method="POST" action="{{ url_for('dashboard_bp.update_email') }}">
                        {{ email_form.hidden_tag() }}
                        <div class="form-group">
                            {{ email_form.email.label(class="form-label") }}
                            <div class="input-group">
                <span class="input-group-text" id="basic-addon1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
  <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"></path>
</svg>
                </span>
                            {{ email_form.email(class="form-control", id="emailInput", readonly=True) }}
              </div>
                            
                        </div>
                        <button type="button" class="btn btn-primary mt-2" id="editEmailButton">Edit</button>
                        {{ email_form.submit(class="btn btn-success mt-2 d-none", id="saveEmailButton") }}
                        <button type="button" class="btn btn-secondary mt-2 d-none" id="cancelEmailButton">Cancel</button>
                    </form>
                </div>
            </div>

            <!-- Phone Number Form -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Update Phone Number<span class="text-danger">*</span></h6>
                </div>
                <div class="card-body">
                    <form id="phoneForm" method="POST" action="{{ url_for('dashboard_bp.update_phone_number') }}">
                        {{ phone_form.hidden_tag() }}
                        <div class="form-group">
                            {{ phone_form.phone_number.label(class="form-label") }}
                            <div class="input-group">
                <span class="input-group-text" id="basic-addon1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="black" class="bi bi-telephone-fill" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z"></path>
</svg>
                </span>
                            {{ phone_form.phone_number(class="form-control", id="phoneInput", readonly=True) }}
              </div>
                        </div>
                        <button type="button" class="btn btn-primary mt-2" id="editPhoneButton">Edit</button>
                        {{ phone_form.submit(class="btn btn-success mt-2 d-none", id="savePhoneButton") }}
                        <button type="button" class="btn btn-secondary mt-2 d-none" id="cancelPhoneButton">Cancel</button>
                    </form>
                </div>
            </div>

            <!-- Password Change Form -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Change Password</h6>
                </div>
                <div class="card-body">
                    <form id="passwordForm" method="POST" action="{{ url_for('dashboard_bp.change_password') }}">
                        {{ password_form.hidden_tag() }}
                        <div class="form-group">{{ password_form.current_password.label(class="form-label") }}{{ password_form.current_password(class="form-control") }}</div>
                        <div class="form-group">{{ password_form.new_password.label(class="form-label") }}{{ password_form.new_password(class="form-control") }}</div>
                        <div class="form-group">{{ password_form.confirm_new_password.label(class="form-label") }}{{ password_form.confirm_new_password(class="form-control") }}</div>
                        {{ password_form.submit(class="btn btn-primary mt-3") }}
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Website Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="/static/care template  1 static/js/scripts.js"></script>

<script>
  // Email Editing
  document.getElementById('editEmailButton').addEventListener('click', function () {
    document.getElementById('emailInput').removeAttribute('readonly');
    document.getElementById('editEmailButton').classList.add('d-none');
    document.getElementById('saveEmailButton').classList.remove('d-none');
    document.getElementById('cancelEmailButton').classList.remove('d-none');
  });

  document.getElementById('cancelEmailButton').addEventListener('click', function () {
    document.getElementById('emailInput').setAttribute('readonly', 'readonly');
    document.getElementById('editEmailButton').classList.remove('d-none');
    document.getElementById('saveEmailButton').classList.add('d-none');
    document.getElementById('cancelEmailButton').classList.add('d-none');
    document.getElementById('emailInput').value = "{{ current_user.email }}";
  });

  // Phone Number Editing
  document.getElementById('editPhoneButton').addEventListener('click', function () {
    document.getElementById('phoneInput').removeAttribute('readonly');
    document.getElementById('editPhoneButton').classList.add('d-none');
    document.getElementById('savePhoneButton').classList.remove('d-none');
    document.getElementById('cancelPhoneButton').classList.remove('d-none');
  });

  document.getElementById('cancelPhoneButton').addEventListener('click', function () {
    document.getElementById('phoneInput').setAttribute('readonly', 'readonly');
    document.getElementById('editPhoneButton').classList.remove('d-none');
    document.getElementById('savePhoneButton').classList.add('d-none');
    document.getElementById('cancelPhoneButton').classList.add('d-none');
    document.getElementById('phoneInput').value = "{{ current_user.phone_number }}";
  });

  // About Me Editing
  document.getElementById('editAboutButton').addEventListener('click', function() {
    document.getElementById('aboutInput').removeAttribute('readonly');
    document.getElementById('saveAboutButton').classList.remove('d-none');
    document.getElementById('cancelAboutButton').classList.remove('d-none');
    this.classList.add('d-none');
  });

  document.getElementById('cancelAboutButton').addEventListener('click', function() {
    document.getElementById('aboutInput').setAttribute('readonly', true);
    document.getElementById('saveAboutButton').classList.add('d-none');
    document.getElementById('editAboutButton').classList.remove('d-none');
    this.classList.add('d-none');
    document.getElementById('aboutInput').value = "{{ current_user.about }}";
  });

  // Social Media Links Editing
  document.getElementById('editSocialMediaButton').addEventListener('click', function () {
    // Enable all social media input fields
    document.getElementById('githubInput').removeAttribute('readonly');
    document.getElementById('linkedinInput').removeAttribute('readonly');
    document.getElementById('facebookInput').removeAttribute('readonly');
    document.getElementById('instagramInput').removeAttribute('readonly');
    document.getElementById('hackerrankInput').removeAttribute('readonly');

    // Show save and cancel buttons, hide edit button
    document.getElementById('editSocialMediaButton').classList.add('d-none');
    document.getElementById('saveSocialMediaButton').classList.remove('d-none');
    document.getElementById('cancelSocialMediaButton').classList.remove('d-none');
  });

  document.getElementById('cancelSocialMediaButton').addEventListener('click', function () {
    // Set all social media input fields back to read-only
    document.getElementById('githubInput').setAttribute('readonly', 'readonly');
    document.getElementById('linkedinInput').setAttribute('readonly', 'readonly');
    document.getElementById('facebookInput').setAttribute('readonly', 'readonly');
    document.getElementById('instagramInput').setAttribute('readonly', 'readonly');
    document.getElementById('hackerrankInput').setAttribute('readonly', 'readonly');

    // Reset values to original
    document.getElementById('githubInput').value = "{{ current_user.github_url or '' }}";
    document.getElementById('linkedinInput').value = "{{ current_user.linkedin_url or '' }}";
    document.getElementById('facebookInput').value = "{{ current_user.facebook_url or '' }}";
    document.getElementById('instagramInput').value = "{{ current_user.instagram_url or '' }}";
    document.getElementById('hackerrankInput').value = "{{ current_user.hackerrank_url or '' }}";

    // Show edit button, hide save and cancel buttons
    document.getElementById('editSocialMediaButton').classList.remove('d-none');
    document.getElementById('saveSocialMediaButton').classList.add('d-none');
    document.getElementById('cancelSocialMediaButton').classList.add('d-none');
  });
</script>
{% endblock %}
